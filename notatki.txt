1. wyliczyc trend logistyczny i reszty na podstawie trendu log
2. zapisać wartości reczywiste reszt + modelowane (excel)
3. zapisać jak wyżej z uwzględnieniem trendu logistycznego
4. zmodyfikować funkcję, żeby zwracała pkt 2 oraz 3
5. zmodyfikować zapis do excela, żeby powtały 4 sheet'y
	a) pkt2
	b) pkt3
	c) błędy
	d) coefs
6. zmodyfikować funkcję (xreg), aby dla dni normalnych(0)- zmienne 0-1 uwzględniające dzień tygodnia, a dla dni specjalnych (1-5) zmienne 0-1 dla całego roku
7. funkcja cft- poprawić funkcjonalność w przypadku gdy model zwraca tylko jedną wartosć (współczynnik)

8. osobe pliki excel dla prognoz wraz z wartościami rzeczywistymi

Wszystko ma być na podstawie reszt z modelu!!!

uwzględnienie daty zrobione


library(car)
logistic.trend <- function(data, nr = 7, wind = NULL)
{
  if(is.null(wind)) wind <- data$key
  
  dat <- data[wind, nr]
  coefs <- coef(lm(logit(dat/max(dat))~wind))
  
  model <- nls(dat ~ phi1/(1+phi2 * exp(-(phi3*wind))), 
              start=list(phi1 = max(dat), phi2 = (coefs[1]), phi3 = (coefs[2])), data = data, trace = TRUE, algorithm = "plinear")
  
  phi1 <- coef(model)[1]
  phi2 <- coef(model)[2]
  phi3 <- coef(model)[3]
  trend <- phi1/(1 + exp(-(phi2 + phi3 * wind))) 
  
  res <- data.frame(x = wind, fit = trend)
  
  return(list(res, dat))
}

plot.logistic.trend <- function(logistic.list)
{
  dat <- logistic.list[[2]]
  predict <- logistic.list[[1]]
  
  cbind(data.frame(data = dat), predict) %>%
    ggplot(aes(x = x)) + 
    geom_line(aes(y = data), color = 'blue') + 
    geom_line(aes(y = fit), color = 'red', size = 2)
}